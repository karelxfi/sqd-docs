---
title: "Basics"
description: "Fundamental pipe concepts and patterns for Solana"
---

Learn the core concepts of Pipes SDK for Solana through practical examples.

## Basic Pipe

Create a source and target to stream raw Solana blockchain data.

```ts
import { createTarget } from '@sqd-pipes/pipes'
import { createSolanaPortalSource, SolanaQueryBuilder } from '@sqd-pipes/pipes/solana'

// Build a query that requests swap instructions from Orca Whirlpool
const queryBuilder = new SolanaQueryBuilder()
  .addFields({
    block: {
      slot: true, hash: true,
    },
    instruction: {
      programId: true,
      data: true,
      accounts: true,
      transactionHash: true,
    },
  })
  .addInstruction({
    request: {
      programId: ['whirLbMiicVdio4qvUfM5KAg6Ct8VwpYzGff3uctyCc'], // Orca Whirlpool
      d8: ['0xf8c69e91e17587c8'], // Swap instruction discriminator
    },
    range: {
      from: 200000000,
      to: 200000000,
    },
  })

async function main() {
  const source = createSolanaPortalSource({
    portal: 'https://portal.sqd.dev/datasets/solana-mainnet',
    query: queryBuilder,
  })

  const target = createTarget({
    write: async ({ctx: {logger, profiler}, read}) => {
      for await (const {data} of read()) {
        logger.info(data, 'data')
      }
    },
  })

  await source.pipeTo(target)
}

void main()
```

The query builder shapes the query sent to the Portal API. All methods only add to the data request. Block `slot` and `hash` fields are required.

## Transformers

Transform data between source and target.

```ts
import { createTarget, createTransformer } from '@sqd-pipes/pipes'
import {
  createSolanaPortalSource,
  type SolanaPortalData,
  SolanaQueryBuilder
} from '@sqd-pipes/pipes/solana'

const queryBuilder = new SolanaQueryBuilder()
  .addFields({
    block: {
      slot: true, hash: true,
    },
    instruction: {
      programId: true,
      data: true,
      accounts: true,
      transactionHash: true,
    },
  })
  .addInstruction({
    request: {
      programId: ['whirLbMiicVdio4qvUfM5KAg6Ct8VwpYzGff3uctyCc'], // Orca Whirlpool
      d8: ['0xf8c69e91e17587c8'], // Swap instruction discriminator
    },
    range: {
      from: 200000000,
      to: 200000000,
    },
  })

async function main() {
  const source = createSolanaPortalSource({
    portal: 'https://portal.sqd.dev/datasets/solana-mainnet',
    query: queryBuilder,
  })

  // Extract transaction hashes from instructions
  const transformer = createTransformer({
    transform: async (data: SolanaPortalData<any>) => {
      return data.blocks.map(b => b.instructions.map(i => i.transactionHash))
    }
  })

  const target = createTarget({
    write: async ({ctx: {logger, profiler}, read}) => {
      for await (const {data} of read()) {
        logger.info({data}, 'data')
      }
    },
  })

  await source.pipe(transformer).pipeTo(target)
}

void main()
```

The transformer converts block and instruction data into an array of transaction hashes.

## Query from Transformer

Build queries dynamically within transformers.

```ts
import { createTarget, createTransformer } from '@sqd-pipes/pipes'
import {
  createSolanaPortalSource,
  type SolanaPortalData,
  SolanaQueryBuilder
} from '@sqd-pipes/pipes/solana'

async function main() {
  const blankQueryBuilder = new SolanaQueryBuilder()

  const source = createSolanaPortalSource({
    portal: 'https://portal.sqd.dev/datasets/solana-mainnet',
    query: blankQueryBuilder,
  })

  // Build the query inside the transformer
  const transformer = createTransformer({
    transform: async (data: SolanaPortalData<any>) => {
      return data.blocks.map(b => b.instructions.map(i => i.transactionHash))
    },
    query: ({queryBuilder, portal, logger}) => {
      queryBuilder.addFields({
        block: {
          slot: true, hash: true,
        },
        instruction: {
          programId: true,
          data: true,
          accounts: true,
          transactionHash: true,
        },
      })
      .addInstruction({
        request: {
          programId: ['whirLbMiicVdio4qvUfM5KAg6Ct8VwpYzGff3uctyCc'], // Orca Whirlpool
          d8: ['0xf8c69e91e17587c8'], // Swap instruction discriminator
        },
        range: {
          from: 200000000,
          to: 200000000,
        },
      })
    }
  })

  const target = createTarget({
    write: async ({ctx: {logger, profiler}, read}) => {
      for await (const {data} of read()) {
        logger.info({data}, 'data')
      }
    },
  })

  await source.pipe(transformer).pipeTo(target)
}

void main()
```

Use the `query` callback to add filters dynamically based on runtime conditions.

## Solana Instructions Decoder

Automatically decode program instructions using ABIs.

```ts
import { createTarget } from '@sqd-pipes/pipes'
import { createSolanaPortalSource, createSolanaInstructionDecoder } from '@sqd-pipes/pipes/solana'
import * as orcaWhirlpool from './abi/orca_whirlpool/index.js'

async function main() {
  const source = createSolanaPortalSource({
    portal: 'https://portal.sqd.dev/datasets/solana-mainnet'
    // Query builder is optional, decoder adds one automatically
  })

  const decoder = createSolanaInstructionDecoder({
    programId: orcaWhirlpool.programId,
    instructions: {
      swap: orcaWhirlpool.instructions.swap,
      swapV2: orcaWhirlpool.instructions.swapV2,
    },
    range: { from: 200_000_000, to: 200_000_000 }
  })

  const target = createTarget({
    write: async ({ctx: {logger, profiler}, read}) => {
      for await (const {data} of read()) {
        // data.swap and data.swapV2 contain decoded swap instructions
        logger.info({data}, 'data')
      }
    },
  })

  await source.pipe(decoder).pipeTo(target)
}

void main()
```

The decoder automatically handles query building and instruction decoding. Each decoded instruction includes `blockNumber`, `timestamp`, `programId`, `transaction`, and the decoded `instruction` fields.

## Composite Pipes

Process multiple data streams simultaneously.

```ts
import { createTarget } from '@sqd-pipes/pipes'
import {
  createSolanaPortalSource,
  createSolanaInstructionDecoder,
} from '@sqd-pipes/pipes/solana'
import * as orcaWhirlpool from './abi/orca_whirlpool/index.js'
import * as raydiumAmm from './abi/raydium-amm/index.js'

const atSlot = 200000000
const oneSlotRange = { from: atSlot, to: atSlot }

async function main() {
  const source = createSolanaPortalSource({
    portal: 'https://portal.sqd.dev/datasets/solana-mainnet',
  })

  const target = createTarget({
    write: async ({ctx: {logger, profiler}, read}) => {
      for await (const {data} of read()) {
        // Access data from both decoders
        logger.info({
          orcaSwaps: data.orcaSwaps.swap.length + data.orcaSwaps.swapV2.length,
          raydiumSwaps: data.raydiumSwaps.swapBaseIn.length + data.raydiumSwaps.swapBaseOut.length
        }, 'data')
      }
    },
  })

  await source
    .pipeComposite({
      orcaSwaps: createSolanaInstructionDecoder({
        programId: orcaWhirlpool.programId,
        instructions: {
          swap: orcaWhirlpool.instructions.swap,
          swapV2: orcaWhirlpool.instructions.swapV2,
        },
        range: oneSlotRange
      }),
      raydiumSwaps: createSolanaInstructionDecoder({
        programId: raydiumAmm.programId,
        instructions: {
          swapBaseIn: raydiumAmm.instructions.swapBaseIn,
          swapBaseOut: raydiumAmm.instructions.swapBaseOut,
        },
        range: oneSlotRange
      })
    })
    .pipeTo(target)
}

void main()
```

Use `pipeComposite` to run multiple decoders in parallel. The data structure contains results from all decoders under their respective keys.

## Next Steps

<CardGroup cols={2}>
<Card
  title="Stateful Indexing"
  icon="database"
  href="/en/sdk/pipes-sdk/solana/stateful-indexing"
>
  Handle cursors and forks
</Card>

<Card
  title="Quality of Life"
  icon="wand-magic-sparkles"
  href="/en/sdk/pipes-sdk/solana/quality-of-life"
>
  Advanced patterns and optimizations
</Card>

<Card
  title="Core Concepts"
  icon="book"
  href="/en/sdk/pipes-sdk/core-concepts/core-concepts"
>
  Understand the architecture
</Card>

<Card
  title="Reference"
  icon="code"
  href="/en/sdk/pipes-sdk/solana/reference/sources"
>
  API reference
</Card>
</CardGroup>

