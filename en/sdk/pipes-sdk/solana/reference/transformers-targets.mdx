---
title: "Transformers & Targets"
description: "API reference for transformers and targets"
---

## Instruction Decoder Transformers

### createSolanaInstructionDecoder

Create a transformer that decodes Solana program instructions.

```ts
createSolanaInstructionDecoder<T>(config: SolanaInstructionDecoderConfig<T>): Transformer
```

**Returns:** A `Transformer` that transforms `SolanaPortalData` into decoded instructions.

**Parameters:**

- `range`: Slot range `{ from: number | string | 'latest', to?: number }` (required)
- `programId`: Program address(es) `string | string[]` (required)
- `instructions`: Map of instruction names to ABI instruction objects (required)
- `profiler`: Profiler config `{ id: string }` (optional)
- `onError`: Error handler (optional)

**Example:**

```ts
const transformer = createSolanaInstructionDecoder({
  range: { from: 200000000, to: 201000000 },
  programId: orcaWhirlpool.programId,
  instructions: {
    swap: orcaWhirlpool.instructions.swap,
  },
});
```

See the [Instruction Decoder reference](/en/sdk/pipes-sdk/solana/reference/instruction-decoder) for complete details.

## Generic Transformers

### createTransformer

Transform data in pipes.

```ts
createTransformer<I, O>(config: TransformerConfig<I, O>): Transformer<I, O>
```

**Parameters:**

- `transform`: Transform function `async (data: I, ctx) => O` (required)
- `query`: Query callback `({queryBuilder, portal, logger}) => void` (optional)

**Example:**

```ts
const transformer = createTransformer({
  query: ({ queryBuilder }) => {
    queryBuilder.addInstruction({
      request: { programId: ["whirLbMiicVdio4qvUfM5KAg6Ct8VwpYzGff3uctyCc"] },
      range: { from: 200000000 },
    });
  },
  transform: async (data) => {
    return data.blocks.map((b) => b.instructions);
  },
});
```

## createTarget

Create a data sink.

```ts
createTarget(config: TargetConfig): Target
```

**Parameters:**

- `write`: Write function `async ({ctx, read}) => void` (required)
- `onRollback`: Rollback handler `async ({cursor, type}) => void` (optional)
- `fork`: Fork handler `async (newConsensusBlocks) => BlockCursor | null` (optional)

**Example:**

```ts
const target = createTarget({
  write: async ({ ctx: { logger, profiler }, read }) => {
    for await (const { data } of read()) {
      await database.save(data);
    }
  },
  onRollback: async ({ cursor }) => {
    await database.deleteAfter(cursor.number);
  },
});
```

## createClickhouseTarget

ClickHouse target with automatic cursor management.

```ts
createClickhouseTarget(config: ClickhouseTargetConfig): Target
```

**Parameters:**

- `client`: ClickHouse client instance (required)
- `onData`: Data handler `async ({store, data, ctx}) => void` (required)
- `onRollback`: Rollback handler `async ({store, cursor, type}) => void` (required)

**Example:**

```ts
const target = createClickhouseTarget({
  client,
  onData: async ({store, data}) => {
    store.insert({
      table: 'swaps',
      values: data.swap.map(s => ({
        slot_number: s.blockNumber,
        transaction_hash: s.transaction.signatures[0],
        program_id: s.programId,
      })),
      format: 'JSONEachRow'
    })
  },
  onRollback: async ({store, cursor}) => {
    await store.removeAllRows({
      tables: ['swaps'],
      where: `slot_number > ${cursor.number}`
    })
  }
})
```

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Sources"
    icon="arrow-left"
    href="/en/sdk/pipes-sdk/solana/reference/sources"
  >
    Sources
  </Card>

  <Card
    title="Query Builder"
    icon="filter"
    href="/en/sdk/pipes-sdk/solana/reference/query-builder"
  >
    Query builder API
  </Card>
</CardGroup>

