---
title: "Reference"
description: "Complete  documentation"
---

## Core Functions

### createEvmPortalSource

Create a Portal source for EVM chains.

```typescript
createEvmPortalSource(config: EvmPortalSourceConfig): Source
```

**Parameters:**

- `portal`: Portal API URL
- `query`: EvmQueryBuilder instance (optional)
- `cursor`: Resume from block `{ blockNumber: number }` (optional)
- `cache`: Cache adapter `{ adapter: CacheAdapter }` (optional)

**Example:**

```typescript
const source = createEvmPortalSource({
  portal: "https://portal.sqd.dev/datasets/ethereum-mainnet",
  query: queryBuilder,
  cursor: { blockNumber: 20000000 },
  cache: { adapter: await sqliteCacheAdapter({ path: "./cache.sqlite" }) },
});
```

### createEvmDecoder

Decode smart contract events as a pipe.

```typescript
createEvmDecoder<T>(config: EvmDecoderConfig<T>): Decoder<T>
```

**Parameters:**

- `range`: Block range `{ from: number | 'latest', to?: number }` (required)
- `contracts`: Array of contract addresses or factory (required)
- `events`: Map of event names to ABI objects (required)
- `profiler`: Profiler config `{ id: string }` (optional)

**Example:**

```typescript
const decoder = createEvmDecoder({
  range: { from: 20000000, to: 20100000 },
  contracts: ["0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"],
  events: {
    transfer: commonAbis.erc20.events.Transfer,
  },
});
```

<Tip>
Use `@subsquid/evm-typegen` to generate typed ABIs for custom contracts. This provides type safety and eliminates the need to manually find event signatures. See the [Event Decoding guide](/en/sdk/pipes-sdk/core-concepts/event-decoding#custom-abis) for details on generating and using custom ABIs.
</Tip>

### createTransformer

Transform data in pipes.

```typescript
createTransformer<I, O>(config: TransformerConfig<I, O>): Transformer<I, O>
```

**Parameters:**

- `transform`: Transform function `async (data: I, ctx) => O` (required)
- `query`: Query callback `({queryBuilder, portal, logger}) => void` (optional)

**Example:**

```typescript
const transformer = createTransformer({
  query: ({ queryBuilder }) => {
    queryBuilder.addLog({
      request: { address: ["0x..."] },
      range: { from: 20000000 },
    });
  },
  transform: async (data) => {
    return data.blocks.map((b) => b.logs);
  },
});
```

### createTarget

Create a data sink.

```typescript
createTarget(config: TargetConfig): Target
```

**Parameters:**

- `write`: Write function `async ({ctx, read}) => void` (required)
- `onRollback`: Rollback handler `async ({cursor, type}) => void` (optional)

**Example:**

```typescript
const target = createTarget({
  write: async ({ ctx: { logger, profiler }, read }) => {
    for await (const { data } of read()) {
      await database.save(data);
    }
  },
  onRollback: async ({ cursor }) => {
    await database.deleteAfter(cursor.blockNumber);
  },
});
```

### createClickhouseTarget

ClickHouse target with automatic cursor management.

```typescript
createClickhouseTarget(config: ClickhouseTargetConfig): Target
```

**Parameters:**

- `client`: ClickHouse client instance (required)
- `onData`: Data handler `async ({store, data, ctx}) => void` (required)
- `onRollback`: Rollback handler `async ({store, cursor, type}) => void` (required)

**Example:**

```typescript
const target = createClickhouseTarget({
  client,
  onData: async ({store, data}) => {
    store.insert({
      table: 'transfers',
      values: data.transfer.map(t => ({...})),
      format: 'JSONEachRow'
    })
  },
  onRollback: async ({store, cursor}) => {
    await store.removeAllRows({
      tables: ['transfers'],
      where: `block_number > ${cursor.number}`
    })
  }
})
```

### createFactory

Track dynamically created contracts.

```typescript
createFactory(config: FactoryConfig): Factory
```

**Parameters:**

- `address`: Factory contract address (required)
- `event`: Factory creation event ABI (required)
- `parameter`: Extract child address `(event) => string` (required)
- `database`: Factory database instance (required)

**Example:**

```typescript
const factory = createFactory({
  address: "0x1f98431c8ad98523631ae4a59f267346ea31f984",
  event: factoryAbi.events.PoolCreated,
  parameter: (e) => e.pool,
  database: await sqliteFactoryDatabase({ path: "./pools.sqlite" }),
});
```

## Query Builder

### EvmQueryBuilder

Build queries for Portal API.

```typescript
class EvmQueryBuilder {
  addFields(fields: FieldSelection): this;
  addLog(config: LogRequest): this;
  addTransaction(config: TransactionRequest): this;
  addTrace(config: TraceRequest): this;
}
```

### addFields

Select fields to return.

```typescript
addFields({
  block: { number: true, hash: true, timestamp: true },
  log: { address: true, topics: true, data: true },
  transaction: { hash: true, from: true, to: true, value: true },
});
```

### addLog

Filter event logs.

```typescript
addLog({
  request: {
    address: ["0x..."],
    topic0: ["0x..."],
    topic1: ["0x..."], // optional
  },
  range: { from: 20000000, to: 20000100 },
});
```

### addTransaction

Filter transactions.

```typescript
addTransaction({
  request: {
    from: ["0x..."],
    to: ["0x..."],
    sighash: ["0xa9059cbb"],
  },
  range: { from: 20000000 },
});
```

## Utilities

### sqliteFactoryDatabase

Create SQLite factory database.

```typescript
sqliteFactoryDatabase(config: { path: string }): Promise<FactoryDatabase>
```

**Example:**

```typescript
const db = await sqliteFactoryDatabase({ path: "./factories.sqlite" });
```

### sqliteCacheAdapter

Create SQLite cache adapter for Portal.

```typescript
sqliteCacheAdapter(config: { path: string }): Promise<CacheAdapter>
```

**Example:**

```typescript
const cache = await sqliteCacheAdapter({ path: "./cache.sqlite" });
```

### commonAbis

Pre-defined ABIs for standard contracts.

```typescript
import { commonAbis } from "@sqd-pipes/pipes/evm";

// ERC20
commonAbis.erc20.events.Transfer;
commonAbis.erc20.events.Approval;

// ERC721
commonAbis.erc721.events.Transfer;
commonAbis.erc721.events.Approval;
commonAbis.erc721.events.ApprovalForAll;
```

## Types

### DecodedEvent

```typescript
interface DecodedEvent<T, F = unknown> {
  blockNumber: number;
  timestamp: Date;
  contract: string;
  transactionHash: string;
  logIndex: number;
  rawEvent: {
    address: string;
    data: string;
    topics: string[];
  };
  event: T;
  factory?: {
    event: F;
  };
}
```

### EvmPortalData

```typescript
interface EvmPortalData<Q> {
  blocks: Array<{
    header: {
      number: number;
      hash: string;
      timestamp: number;
      // ... other fields
    };
    logs: Array<{
      address: string;
      topics: string[];
      data: string;
      transactionHash: string;
      logIndex: number;
    }>;
    transactions: Array<{
      hash: string;
      from: string;
      to: string;
      value: bigint;
      // ... other fields
    }>;
  }>;
}
```

### Context

```typescript
interface Context {
  logger: Logger;
  profiler: Profiler;
}
```

### Logger

```typescript
interface Logger {
  info(message: string | object, ...args: any[]): void;
  warn(message: string | object, ...args: any[]): void;
  error(message: string | object, ...args: any[]): void;
}
```

### Profiler

```typescript
interface Profiler {
  start(id: string): Span;
}

interface Span {
  end(): void;
}
```

## Pipe Methods

### pipe

Chain a transformer.

```typescript
source.pipe(transformer);
```

### pipeComposite

Chain multiple transformers.

```typescript
source.pipeComposite({
  transfers: decoder1,
  swaps: decoder2,
});
```

### pipeTo

Connect to a target.

```typescript
source.pipeTo(target);
```

## Complete Type Example

```typescript
import type {
  Source,
  Transformer,
  Target,
  Context,
  DecodedEvent,
} from "@sqd-pipes/pipes";

import type {
  EvmPortalData,
  EvmPortalSourceConfig,
  EvmDecoderConfig,
  EvmQueryBuilder,
} from "@sqd-pipes/pipes/evm";

import type {
  ClickhouseTargetConfig,
  Store,
} from "@sqd-pipes/pipes/targets/clickhouse";
```

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Examples"
    icon="lightbulb"
    href="/en/sdk/pipes-sdk/examples/getting-started"
  >
    View code examples
  </Card>

{" "}

<Card title="Core Concepts" icon="book" href="/en/sdk/pipes-sdk/core-concepts/overview">
  Learn the architecture
</Card>

  <Card
    title="Migration"
    icon="arrow-right"
    href="/en/sdk/pipes-sdk/reference/migration-from-squid-sdk"
  >
    Migrate from Squid SDK
  </Card>
</CardGroup>
